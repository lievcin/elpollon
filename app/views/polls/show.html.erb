<div class="ss-header">
	<h3><%=@poll.name %>
		<small class= "poll-actions pull-right">
		  <div class="btn-group">
			
			<a class="btn btn-mini" href="#password" data-toggle="modal" id="#icon-fire"><i class="icon-fire"></i></a>
			
			<button class="btn btn-mini">Administrar</button>
		  	<button class="btn btn-mini dropdown-toggle" data-toggle="dropdown">
		      <span class="caret"></span>
		  	</button>
				<ul class="dropdown-menu">
		    	  <li><%= link_to 'Editar', edit_poll_path(@poll) %></li>
				  <li><%= link_to 'Destruir', @poll, method: :delete, data: { confirm: 'Esta seguro?' } %>
		  	    </ul>
		  </div>
		
		  <div class="btn-group">
			
			<%= link_to "Clasificación", ranking_path(:id => @poll.id), class: "btn btn-mini btn-warning" %>
     		<%= link_to "Miembros", members_path(:id => @poll.id), class: "btn btn-mini btn-primary" %>			

		  	<button class="btn btn-mini btn-primary dropdown-toggle" data-toggle="dropdown">
		      <span class="caret"></span>
		  	</button>
			<ul class="dropdown-menu">
  			  <li><%= link_to "Invíta amigos en Facebook", "#", :class => "fb-invite" %></li>
	  	    </ul>

		  </div>		
	    </small>
	</h3>
</div>

<div class="progress progress-striped active">
  <div class="bar" style="width:<%= 100*(1 - @poll.cup.games.where("kickoff > ?", Time.now).count/@poll.cup.games.count)%>%;"></div>
</div>

<div id="password" class="modal hide fade">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
    <h3>Esta es la clave de la polla </h3>
  </div>
  <div class="modal-body">
    <p>En caso de que tus amigos no reciban las notificaciones en Facebook, deben poner el nombre de la polla y esta clave para poder unirse</p>
    <p><strong><%= @poll.password %></strong></p>
  </div>
</div>

	<div>
		<h3>Partidos</h3>

		<table class="table">
			<tr>
			  <th>Fecha</th>
			  <th></th>
			  <th></th>
			  <th>Resultado</th>
			  <th>Apuesta</th>
			  <th></th>
			  <th></th>
			</tr>
			<% @games.each do |game| %>
			  <tr>
				<td><%= game.kickoff.to_formatted_s(:short) %></td>
				<td><%= truncate(Team.find(game.home_team_id).name, :length => 15) %></td>
				<td><%= image_tag(Team.find(game.home_team_id).logo, :id => 'team_logo') %></td>
				<% if game.home_score.nil? %>
				<td> - :
				<% else %>
				<td><%= game.home_score %> :
				<% end %>

				<% if game.away_score.nil? %>
				- </td>
				<% else %>
				<%= game.away_score %> </td>
				<% end %>

				<% @bet = Bet.where("user_id = ? and poll_id = ? and game_id = ?", current_user.id, @poll.id, game.id) %>

				<% if @bet.empty? %>
				<td>
					<%= simple_form_for(@new_bet, :remote => true) do |f| %>
				    <%= f.input :game_id, input_html: { value: game.id }, :as => :hidden %>
				    <%= f.input :poll_id, input_html: { value: @poll.id }, :as => :hidden %>
					<%= f.input :user_id, input_html: { value: current_user.id }, :as => :hidden %>
					<% if game.kickoff < Time.now %>
					<%= f.number_field :home_bet, disabled: true %> :
					<%= f.number_field :away_bet, disabled: true %>
					<% else %>
					<%= f.number_field :home_bet, :class => 'submittable' %> :
					<%= f.number_field :away_bet, :class => 'submittable' %>
					<% end %>
				  <% end %>
				</td>
				  <% else %>
				<td><%= simple_form_for(@bet[0], :remote => true) do |f| %>
				    <%= f.input :game_id, input_html: { value: game.id }, :as => :hidden %>
				    <%= f.input :poll_id, input_html: { value: @poll.id }, :as => :hidden %>
					<%= f.input :user_id, input_html: { value: current_user.id }, :as => :hidden %>
					<% if game.kickoff < Time.now %>
					<%= f.number_field :home_bet, disabled: true %> :
					<%= f.number_field :away_bet, disabled: true %>
					<% else %>
					<%= f.number_field :home_bet, :class => 'submittable' %> :
					<%= f.number_field :away_bet, :class => 'submittable' %>
					<% end %>
				  <% end %>
				</td>
				<% end%>
				<td><%= image_tag(Team.find(game.away_team_id).logo, :id => 'team_logo') %></td>
				<td><%= truncate(Team.find(game.away_team_id).name, :length => 15) %></td>
			   </tr>
			<% end %>
		</table>
	</div>
